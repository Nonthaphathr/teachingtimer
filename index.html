<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô - ‡∏Ñ‡∏£‡∏π‡∏ô‡∏ô‡∏ó‡∏û‡∏±‡∏ó‡∏ò‡πå ‡∏´‡∏¥‡∏£‡∏±‡∏ç‡πÄ‡∏£‡∏∑‡∏≠‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Prompt', sans-serif; }
        
        /* Animation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô */
        @keyframes pulse-warning {
            0%, 100% { background-color: #fef08a; color: #854d0e; } /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á */
            50% { background-color: #fffbeb; color: #a16207; }
        }
        @keyframes blink-critical {
            0%, 100% { background-color: #fee2e2; color: #b91c1c; } /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á */
            50% { background-color: #7f1d1d; color: #ffffff; }
        }

        .warning-mode {
            animation: pulse-warning 2s infinite;
        }
        .critical-mode {
            animation: blink-critical 0.5s infinite;
        }

        /* ‡∏ã‡πà‡∏≠‡∏ô Scrollbar ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen flex flex-col overflow-hidden">

    <header class="p-4 bg-gray-800 border-b border-gray-700 flex justify-between items-center shrink-0">
        <div>
            <h1 class="text-xl md:text-2xl font-bold text-blue-400">‚è±Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</h1>
            <p class="text-xs md:text-sm text-gray-400">‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ ‡∏Ñ‡∏£‡∏π‡∏ô‡∏ô‡∏ó‡∏û‡∏±‡∏ó‡∏ò‡πå ‡∏´‡∏¥‡∏£‡∏±‡∏ç‡πÄ‡∏£‡∏∑‡∏≠‡∏á</p>
        </div>
        <div id="totalTimeDisplay" class="text-lg md:text-xl font-mono text-green-400 font-bold hidden">
            ‡∏£‡∏ß‡∏°: 00:00:00
        </div>
    </header>

    <main id="setupScreen" class="flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full">
        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
            <h2 class="text-xl mb-4 font-semibold text-gray-200">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h2>
            
            <div class="mb-6 flex items-center gap-4">
                <label class="text-gray-300">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡πà‡∏ß‡∏á:</label>
                <select id="segmentCount" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white focus:outline-none focus:border-blue-500" onchange="generateInputs()">
                    </select>
                <button onclick="runDemo()" class="ml-auto bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded shadow transition text-sm">
                    üé¨ ‡πÇ‡∏´‡∏°‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                </button>
            </div>

            <div id="inputsContainer" class="space-y-3 mb-6 max-h-[50vh] overflow-y-auto no-scrollbar pr-2">
                </div>

            <div class="flex justify-between items-center border-t border-gray-700 pt-4">
                <div class="text-gray-400">
                    ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="setupTotalTime" class="text-white font-bold text-lg">0 ‡∏ô‡∏≤‡∏ó‡∏µ</span>
                </div>
                <button onclick="startTimer()" class="bg-green-600 hover:bg-green-700 text-white text-lg px-8 py-3 rounded-lg shadow-lg font-bold transition transform hover:scale-105">
                    üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
                </button>
            </div>
        </div>
    </main>

    <main id="timerScreen" class="hidden flex-1 flex flex-col items-center justify-center relative transition-colors duration-500">
        
        <div class="absolute top-10 left-0 right-0 text-center px-4">
            <h2 class="text-gray-400 text-xl md:text-2xl mb-2">‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà <span id="currentSegmentNum">1</span>/<span id="totalSegmentNum">5</span></h2>
            <h1 id="currentSegmentName" class="text-4xl md:text-6xl font-bold text-white leading-tight drop-shadow-lg">
                ‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
            </h1>
        </div>

        <div class="text-[15vw] md:text-[20vh] font-mono font-bold leading-none tracking-wider drop-shadow-2xl tabular-nums" id="timerDisplay">
            00:00
        </div>

        <div class="w-full max-w-3xl px-8 mt-8">
            <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                <div id="progressBar" class="bg-blue-500 h-4 rounded-full transition-all duration-1000" style="width: 100%"></div>
            </div>
        </div>

        <div class="absolute bottom-10 flex gap-4 opacity-50 hover:opacity-100 transition-opacity">
            <button onclick="togglePause()" id="pauseBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-full">‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</button>
            <button onclick="skipSegment()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full">‡∏Ç‡πâ‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
            <button onclick="resetSystem()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-full">‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</button>
        </div>
    </main>

    <script>
        // --- Configuration ---
        const MAX_SEGMENTS = 15;
        let segments = [];
        let currentSegmentIndex = 0;
        let timeLeft = 0; // seconds
        let totalTimeInitial = 0; // seconds for current segment
        let timerInterval = null;
        let isPaused = false;
        let isDemo = false;

        // --- Init ---
        window.onload = function() {
            const select = document.getElementById('segmentCount');
            for(let i=1; i<=MAX_SEGMENTS; i++) {
                let opt = document.createElement('option');
                opt.value = i;
                opt.innerText = `${i} ‡∏ä‡πà‡∏ß‡∏á`;
                select.appendChild(opt);
            }
            select.value = 3; // Default
            generateInputs();
        }

        // --- Setup Logic ---
        function generateInputs() {
            const count = document.getElementById('segmentCount').value;
            const container = document.getElementById('inputsContainer');
            container.innerHTML = '';

            for(let i=1; i<=count; i++) {
                const row = document.createElement('div');
                row.className = "flex flex-col md:flex-row gap-2 items-start md:items-center bg-gray-700/50 p-3 rounded hover:bg-gray-700 transition";
                row.innerHTML = `
                    <span class="bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded w-8 text-center">${i}</span>
                    <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏±‡πâ‡∏ô‡∏ô‡∏≥, ‡∏™‡∏≠‡∏ô)" class="segment-name flex-1 bg-gray-800 border border-gray-600 rounded px-3 py-2 text-white focus:border-blue-500 focus:outline-none w-full">
                    <div class="flex items-center gap-2">
                        <input type="number" min="0" placeholder="‡∏ô‡∏≤‡∏ó‡∏µ" class="segment-min w-20 bg-gray-800 border border-gray-600 rounded px-3 py-2 text-white text-center focus:border-blue-500 focus:outline-none" oninput="calculateTotalSetupTime()">
                        <span class="text-gray-400">:</span>
                        <input type="number" min="0" max="59" placeholder="‡∏ß‡∏¥" value="00" class="segment-sec w-16 bg-gray-800 border border-gray-600 rounded px-3 py-2 text-white text-center focus:border-blue-500 focus:outline-none" oninput="calculateTotalSetupTime()">
                    </div>
                `;
                container.appendChild(row);
            }
            calculateTotalSetupTime();
        }

        function calculateTotalSetupTime() {
            let totalSeconds = 0;
            const mins = document.querySelectorAll('.segment-min');
            const secs = document.querySelectorAll('.segment-sec');
            
            mins.forEach((minInput, index) => {
                const m = parseInt(minInput.value) || 0;
                const s = parseInt(secs[index].value) || 0;
                totalSeconds += (m * 60) + s;
            });

            const display = formatTime(totalSeconds);
            document.getElementById('setupTotalTime').innerText = `${display.m} ‡∏ô‡∏≤‡∏ó‡∏µ ${display.s} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
            return totalSeconds;
        }

        // --- Timer Logic ---
        function startTimer() {
            segments = [];
            const names = document.querySelectorAll('.segment-name');
            const mins = document.querySelectorAll('.segment-min');
            const secs = document.querySelectorAll('.segment-sec');

            let hasTime = false;

            names.forEach((nameInput, index) => {
                const m = parseInt(mins[index].value) || 0;
                const s = parseInt(secs[index].value) || 0;
                if ((m*60)+s > 0) hasTime = true;
                
                segments.push({
                    name: nameInput.value || `‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà ${index + 1}`,
                    duration: (m * 60) + s
                });
            });

            if (!hasTime && !isDemo) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏£‡∏±‡∏ö");
                return;
            }

            // UI Switch
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('timerScreen').classList.remove('hidden');
            document.getElementById('totalTimeDisplay').classList.remove('hidden');

            currentSegmentIndex = 0;
            loadSegment(currentSegmentIndex);
        }

        function loadSegment(index) {
            if (index >= segments.length) {
                finishAll();
                return;
            }

            const seg = segments[index];
            timeLeft = seg.duration;
            totalTimeInitial = seg.duration;

            document.getElementById('currentSegmentNum').innerText = index + 1;
            document.getElementById('totalSegmentNum').innerText = segments.length;
            document.getElementById('currentSegmentName').innerText = seg.name;
            
            resetStyles();
            updateDisplay();
            
            if (timerInterval) clearInterval(timerInterval);
            isPaused = false;
            document.getElementById('pauseBtn').innerText = "‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß";
            
            timerInterval = setInterval(tick, 1000);
        }

        function tick() {
            if (isPaused) return;

            timeLeft--;
            updateDisplay();
            checkWarnings();

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                playAlarm(); // Optional sound
                setTimeout(() => {
                    currentSegmentIndex++;
                    loadSegment(currentSegmentIndex);
                }, 1000);
            }
        }

        function checkWarnings() {
            const screen = document.getElementById('timerScreen');
            const text = document.getElementById('timerDisplay');
            
            // 2 Minutes Warning (120s)
            if (timeLeft <= 120 && timeLeft > 30) {
                screen.className = "flex-1 flex flex-col items-center justify-center relative warning-mode transition-colors duration-500";
            } 
            // 30 Seconds Critical
            else if (timeLeft <= 30) {
                screen.className = "flex-1 flex flex-col items-center justify-center relative critical-mode";
            }
            else {
                resetStyles();
            }
        }

        function resetStyles() {
            const screen = document.getElementById('timerScreen');
            // Reset to dark theme
            screen.className = "flex-1 flex flex-col items-center justify-center relative bg-gray-900 text-white transition-colors duration-500";
        }

        function updateDisplay() {
            const timeObj = formatTime(timeLeft);
            // Format 00:00
            document.getElementById('timerDisplay').innerText = 
                `${String(timeObj.m).padStart(2,'0')}:${String(timeObj.s).padStart(2,'0')}`;

            // Progress Bar
            const percent = (timeLeft / totalTimeInitial) * 100;
            document.getElementById('progressBar').style.width = `${percent}%`;

            // Update Total Remaining (Optional calculation could be added here)
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return { m, s };
        }

        function togglePause() {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').innerText = isPaused ? "‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠" : "‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß";
        }

        function skipSegment() {
            clearInterval(timerInterval);
            currentSegmentIndex++;
            loadSegment(currentSegmentIndex);
        }

        function resetSystem() {
            clearInterval(timerInterval);
            document.getElementById('timerScreen').classList.add('hidden');
            document.getElementById('totalTimeDisplay').classList.add('hidden');
            document.getElementById('setupScreen').classList.remove('hidden');
            resetStyles();
        }

        function finishAll() {
            resetStyles();
            document.getElementById('currentSegmentName').innerText = "üéâ ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô";
            document.getElementById('timerDisplay').innerText = "00:00";
            document.getElementById('progressBar').style.width = "0%";
            // Play sound?
        }

        // --- Demo Mode ---
        function runDemo() {
            isDemo = true;
            // Setup fake data
            document.getElementById('segmentCount').value = 2;
            generateInputs();
            
            const names = document.querySelectorAll('.segment-name');
            const mins = document.querySelectorAll('.segment-min');
            const secs = document.querySelectorAll('.segment-sec');

            // Segment 1: Demo Warning (Set to 2 mins 5 secs)
            names[0].value = "‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà 1 (‡∏Ç‡∏±‡πâ‡∏ô‡∏ô‡∏≥)";
            mins[0].value = 2;
            secs[0].value = 5; // Will trigger warning in 5 seconds

            // Segment 2: Demo Critical (Set to 35 secs)
            names[1].value = "‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà 2 (‡∏™‡∏£‡∏∏‡∏õ)";
            mins[1].value = 0;
            secs[1].value = 35; // Will trigger critical blink in 5 seconds

            startTimer();
        }

        function playAlarm() {
            // Simple Beep using Web Audio API (No external file needed)
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // A4
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        }
    </script>
</body>
</html>
